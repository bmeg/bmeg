#
# Generated /etc/nginx/sites-available/default
# %variables% are interpolated by run.sh
lua_package_path '/etc/nginx/lua/?.lua;';

server {
	listen *:80;
	resolver %resolver_address% ipv6=off;
	server_name %server_name%;
	return 301 https://$host$request_uri;

	# for testing
	# lua_ssl_trusted_certificate /etc/ssl/certs/ca-certificates.crt;
	# lua_ssl_verify_depth        5;
	# include /etc/nginx/sites-available/locations;
}

server {

    listen *:443 default_server ssl;
    resolver %resolver_address% ipv6=off;
		server_name %server_name%;

    lua_ssl_trusted_certificate /etc/ssl/certs/ca-certificates.crt;
    lua_ssl_verify_depth        5;

    ssl_certificate /etc/letsencrypt/live/%server_name%/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/%server_name%/privkey.pem;

		include /etc/nginx/sites-available/locations;
}

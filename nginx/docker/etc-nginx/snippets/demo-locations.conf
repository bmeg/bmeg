# deny write-api see https://github.com/bmeg/grip/blob/master/gripql/gripql.proto

# read apis
location / {
  root /etc/nginx/public;
  try_files $uri $uri/index.html $uri.html =404;
}
location /analyze/access {
  include /etc/nginx/snippets/protected.conf;
  root /etc/nginx/public;
  try_files $uri $uri/index.html $uri.html =404;
}
location /grip/ {
  include /etc/nginx/snippets/protected.conf;
  proxy_pass http://%grip_server%/;
}
# /api/v1/graph/bmeg_rc1_2/query
location ~ ^/api/(.*/query) {
  include /etc/nginx/snippets/protected.conf;
  proxy_buffering off;
  proxy_pass http://%grip_server%/$1;
}
location /api/ {
  limit_except GET HEAD { deny all; }
  include /etc/nginx/snippets/protected.conf;
  proxy_pass http://%grip_server%/;
}
location /v1/ {
  limit_except GET HEAD { deny all; }
  include /etc/nginx/snippets/protected.conf;
  proxy_pass http://%grip_server%/v1/;
}
location /_oauth {
  include /etc/nginx/snippets/protected.conf;
}
location /_signout {
  include /etc/nginx/snippets/protected.conf;
}
location /_token.txt {
  include /etc/nginx/snippets/protected.conf;
}
location /_token.json {
  include /etc/nginx/snippets/protected.conf;
}
location /_token.curl {
  include /etc/nginx/snippets/protected.conf;
}
